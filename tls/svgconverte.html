<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="¬´SVG –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä¬ª –æ—Ç ¬´Asirus¬ª: –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—ë —Ñ–æ—Ç–æ, –∏ –ø–æ–ª—É—á–∏—Ç–µ –µ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .svg">
<link rel="icon" href="/res/img/favicon.png">
<title>SVG –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</title>
<style>
  body { 
    font-family: sans-serif; 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    padding: 20px; 
    padding-bottom: 50px; 
    gap: 10px; 
  }
  img { 
    max-width: 200px; 
    max-height: 200px; 
    border: 1px solid #ccc; 
  }
  button { 
    padding: 8px 16px; 
    cursor: pointer; 
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ —è–∑—ã–∫–∞ –∏–∑ hex-editor */
  .lang-container {
      position: fixed;
      bottom: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
      z-index: 101;
  }
  
  .lang {
      width: 30px;
      height: 30px;
      overflow: hidden;
      font-size: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
  }
  
  .lang:hover {
      background: #f0f0f0;
  }
  
  .lang.active {
      border: 2px solid #4b6cb7;
  }

  .instructions-container {
      position: absolute;
      top: 10px;
      left: 10px;
  }

  .instructions-btn {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background: #4b6cb7;
      color: white;
      border: none;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  .instructions-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
  }

  .instructions-overlay.active {
      opacity: 1;
      visibility: visible;
  }

  .instructions-content {
      background: white;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      max-height: 80%;
      overflow: auto;
      padding: 20px;
      position: relative;
  }

  .instructions-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
  }
</style>
</head>
<body>
  <div class="instructions-container">
      <button class="instructions-btn" id="instructionsBtn">?</button>
  </div>

  <h2 data-i18n="title">SVG –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä</h2>
  <h5 data-i18n="subtitle">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—ë —Ñ–æ—Ç–æ, –∏ –ø–æ–ª—É—á–∏—Ç–µ svg –≤–µ—Ä—Å–∏—é —Å–≤–æ–µ–≥–æ —Ñ–æ—Ç–æ!</h5>
  <p data-i18n="warning">[ ! ] –í–Ω–∏–º–∞–Ω–∏–µ! –ï—Å–ª–∏ —Ñ–æ—Ç–æ –æ–≥—Ä–æ–º–Ω–æ–µ, —Ç–æ svg –±—É–¥–µ—Ç –≤–µ—Å–∏—Ç—å –≤ 50 —Ä–∞–∑ –±–æ–ª—å—à–µ. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ–ª—å—à–æ–µ —Ñ–æ—Ç–æ, –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å .svg. –°–æ–≤–µ—Ç—É–µ—Ç—Å—è –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø–∏–∫—Å–µ–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫.</p>
  <input type="file" id="fileInput" accept="image/*">
  <img id="preview" alt="Preview">
  <button id="downloadBtn" disabled data-i18n="download">–°–∫–∞—á–∞—Ç—å SVG</button>

  <!-- Language selector -->
  <div class="lang-container">
      <button class="lang" id="langRu">üá∑üá∫</button>
      <button class="lang active" id="langEn">üá¨üáß</button>
  </div>

  <!-- Instructions Overlay -->
  <div class="instructions-overlay" id="instructionsOverlay">
      <div class="instructions-content">
          <button class="instructions-close" id="instructionsClose">√ó</button>
          <h2 data-i18n="instructionTitle">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å SVG –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–º</h2>
          <ol>
              <li data-i18n="instruction1">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.</li>
              <br>
              <li data-i18n="instruction2">–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞.</li>
              <br>
              <li data-i18n="instruction3">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–°–∫–∞—á–∞—Ç—å SVG¬ª —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.</li>
              <br>
              <li data-i18n="instruction4">–î–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ–±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –Ω–∏–∑–∫–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º.</li>
              <br>
              <li data-i18n="instruction5">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º –ª—É—á—à–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ SVG.</li>
          </ol>
      </div>
  </div>

  <script>
      // Language support
      const translations = {
          'ru': {
              'title': 'SVG –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä',
              'subtitle': '–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—ë —Ñ–æ—Ç–æ, –∏ –ø–æ–ª—É—á–∏—Ç–µ svg –≤–µ—Ä—Å–∏—é —Å–≤–æ–µ–≥–æ —Ñ–æ—Ç–æ!',
              'warning': '[ ! ] –í–Ω–∏–º–∞–Ω–∏–µ! –ï—Å–ª–∏ —Ñ–æ—Ç–æ –æ–≥—Ä–æ–º–Ω–æ–µ, —Ç–æ svg –±—É–¥–µ—Ç –≤–µ—Å–∏—Ç—å –≤ 50 —Ä–∞–∑ –±–æ–ª—å—à–µ. –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–æ–ª—å—à–æ–µ —Ñ–æ—Ç–æ, –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å .svg. –°–æ–≤–µ—Ç—É–µ—Ç—Å—è –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –ø–∏–∫—Å–µ–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–∏–Ω–æ–∫.',
              'download': '–°–∫–∞—á–∞—Ç—å SVG',
              'instructionTitle': '–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–±–æ—Ç–µ —Å SVG –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–º',
              'instruction1': '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ–ª–µ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.',
              'instruction2': '–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞.',
              'instruction3': '–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–°–∫–∞—á–∞—Ç—å SVG¬ª —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.',
              'instruction4': '–î–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ–±–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –Ω–∏–∑–∫–∏–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º.',
              'instruction5': '–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º —Ñ–æ–Ω–æ–º –ª—É—á—à–µ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ SVG.'
          },
          'en': {
              'title': 'SVG Converter',
              'subtitle': 'Upload your photo and get its SVG version!',
              'warning': '[ ! ] Warning! If the photo is huge, the SVG will weigh 50 times more. If you upload a large photo, the browser may not load the .svg. Recommended for small pixel images.',
              'download': 'Download SVG',
              'instructionTitle': 'SVG Converter Instructions',
              'instruction1': 'Click on the file selection field to upload an image.',
              'instruction2': 'After uploading, the image will appear in the preview area.',
              'instruction3': 'Click the "Download SVG" button to download the converted image.',
              'instruction4': 'For best results, use small images with low resolution.',
              'instruction5': 'Images with transparent background convert better to SVG.'
          }
      };

      // Language management
      let currentLang = 'ru';

      function setLanguage(lang) {
          currentLang = lang;
          localStorage.setItem('svgConverterLang', lang);
          
          // Update active button
          document.getElementById('langRu').classList.toggle('active', lang === 'ru');
          document.getElementById('langEn').classList.toggle('active', lang === 'en');
          
          // Update all translatable elements
          document.querySelectorAll('[data-i18n]').forEach(element => {
              const key = element.getAttribute('data-i18n');
              if (translations[lang][key]) {
                  element.innerHTML = translations[lang][key];
              }
          });
      }

      // Initialize language
      document.addEventListener('DOMContentLoaded', () => {
          const savedLang = localStorage.getItem('svgConverterLang') || 'ru';
          setLanguage(savedLang);
          
          // Language button event listeners
          document.getElementById('langRu').addEventListener('click', () => setLanguage('ru'));
          document.getElementById('langEn').addEventListener('click', () => setLanguage('en'));

          // Instructions button
          document.getElementById('instructionsBtn').addEventListener('click', () => {
              document.getElementById('instructionsOverlay').classList.add('active');
          });

          // Close instructions
          document.getElementById('instructionsClose').addEventListener('click', () => {
              document.getElementById('instructionsOverlay').classList.remove('active');
          });

          // Close instructions when clicking outside
          document.getElementById('instructionsOverlay').addEventListener('click', (e) => {
              if (e.target === document.getElementById('instructionsOverlay')) {
                  document.getElementById('instructionsOverlay').classList.remove('active');
              }
          });
      });

      const fileInput = document.getElementById('fileInput');
      const preview = document.getElementById('preview');
      const downloadBtn = document.getElementById('downloadBtn');

      /**
       * –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ–¥—É—â–µ–≥–æ –Ω—É–ª—è –∫ —á–∏—Å–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 -> 05)
       * @param {number} number 
       * @returns {string}
       */
      const pad = (number) => (number < 10 ? '0' : '') + number;

      // --- –°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç—É—Ç, –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ ---
      fileInput.addEventListener('change', () => {
          const file = fileInput.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = e => {
              const img = new Image();
              img.onload = () => {
                  const width = img.width;
                  const height = img.height;

                  // Canvas –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∏–∫—Å–µ–ª–µ–π
                  const canvas = document.createElement('canvas');
                  canvas.width = width;
                  canvas.height = height;
                  const ctx = canvas.getContext('2d');
                  ctx.drawImage(img, 0, 0);

                  const imageData = ctx.getImageData(0, 0, width, height).data;

                  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SVG —Å <rect> –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∏–∫—Å–µ–ª—è
                  let svgRects = '';
                  for (let y = 0; y < height; y++) {
                      for (let x = 0; x < width; x++) {
                          const idx = (y * width + x) * 4;
                          const r = imageData[idx];
                          const g = imageData[idx + 1];
                          const b = imageData[idx + 2];
                          const a = imageData[idx + 3] / 255;
                          if (a > 0) { // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–µ
                              svgRects += `<rect x="${x}" y="${y}" width="1" height="1" fill="rgba(${r},${g},${b},${a})"/>`;
                          }
                      }
                  }

                  const svgContent = `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}">${svgRects}</svg>`;

                  // –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                  const blob = new Blob([svgContent], { type: "image/svg+xml" });
                  const url = URL.createObjectURL(blob);

                  // --- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ ---
                  const now = new Date();
                  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –∏–∑ 5 —Ü–∏—Ñ—Ä (–æ—Ç 10000 –¥–æ 99999)
                  const randomNumber = Math.floor(10000 + Math.random() * 90000); 

                  const filename = 
                      `${now.getFullYear()}.` +
                      `${pad(now.getMonth() + 1)}.` + // –ú–µ—Å—è—Ü—ã –≤ JS —Å 0, –ø–æ—ç—Ç–æ–º—É + 1
                      `${pad(now.getDate())}.` +
                      `${pad(now.getHours())};` + // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ; –¥–ª—è —á–∞—Å–æ–≤ –∏ –º–∏–Ω—É—Ç
                      `${pad(now.getMinutes())}.` +
                      `${randomNumber}.svg`; 
                  // ---------------------------

                  downloadBtn.onclick = () => {
                      const a = document.createElement('a');
                      a.href = url;
                      a.download = filename; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º—è
                      a.click();
                      URL.revokeObjectURL(url);
                  };
                  downloadBtn.disabled = false;

                  preview.src = e.target.result;
              };
              img.src = e.target.result;
          };
          reader.readAsDataURL(file);
      });
  </script>
</body>
</html> 
